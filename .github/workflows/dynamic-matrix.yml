name: Dynamic Matrix

on:
  workflow_dispatch:

jobs:
  outputs:
    runs-on: ubuntu-latest
    outputs:
      random-number: ${{ steps.random-number.outputs }}
    steps:
      - id: random-number
        uses: actions/github-script@v3
        with:
          script: |
            const min = 1;
            const max = 5;
            // generate an array of strings such as ['matrix1', matrix2', 'matrix3'] based on the random number
            const randomnumber = Math.floor(Math.random() * (max - min + 1)) + min;
            let returnArray = [];
            for (let i = 1; i <= randomnumber; i++) {
              returnArray.push(`matrix${i}`);
            }
            return returnArray;

  matrix:
    needs: outputs
    runs-on: ubuntu-latest
    strategy:
      matrix:
        iteration: ${{ fromJson(needs.outputs.outputs.random-number) }}
    steps:
      - name: Matrix - ${{ matrix.iteration }}
        run: echo ${{ matrix.iteration }}
